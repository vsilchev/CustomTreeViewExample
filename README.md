# CustomTreeViewExample
Example code with visualization of hierarchical data using D3.js library.

## Задача

Есть Splunk Enterprise - некая универсальная платформа для сбора и хранения данных с красивым и удобным веб-интерфейсом и мощным движком под капотом, построенным на модели MapReduce. Специалисты в области ИБ любят использовать эту платформу в качестве системы мониторинга событий и выявлять с её помощью инциденты безопасности. В таком случае, основным источником данных являются логи от различных систем безопасности (антивирус, межсетевые экраны IPS/IDS и др.). В Splunk есть множество стандартных способов визуализации данных, но если их не хватает, можно написать свои, для чего есть Splunk Web Framework.

Одним из таких источников является Web Application Firewall, который работает на уровне протокола HTTP, т.е. анализирует входящие запросы к защищаемому Web-серверу и соответствующие ответы от него, пытаясь выявить различные атаки (например, SQL Injection или XSS) или утечку данных.

WAF умеет разбирать http-запрос на составные части и записывать его структуру в виде дерева. Наша задача была визуализировать эту структуру в Splunk Enterprise, реализовав для этого специальный модуль на Splunk Web Framework, используя D3.js.

## Формат данных
Разобранный http-запрос сохранялся в виде строки в формате JSON, но не совсем очевидным способом. Например, есть запрос со следующим URL: `http://example.com/resource?foo=yes&bar=1` то WAF создаст следующую структуру:

```JSON
[
  "URL",
  {
    "type": "Object",
    "value": "http://example.com/resource?foo=yes&bar=1",
    "children": [
      [
        "scheme",
        {"type": "string", "value": "http"}
      ], [
        "host",
        {"type": "string", "value": "example.com"}
      ], [
        "path",
        {"type": "string", "value": "resource"}
      ], [
        "query",
        {
          "type": "object",
          "value": "foo=yes&bar=1",
          "children": [
            [
              "foo",
              {"type": "string", "value": "yes"}
            ],[
              "bar",
              {"type": "string", "value": "1"}
            ]]
        }
      ]]
  }
]
```

И это только часть http-запроса, в котором есть ещё и другие компоненты, например, тип запроса (GET, POST и др.), параметры и тело запроса, которые тоже могут декомпозироваться на составляющие элементы.

## Splunk Web Framework
Для создания нестандартных блоков с визуализацией в Splunk Web Framework сделан супер-класс `SimpleSplunkView`, соответственно, наш класс `TreeView` дожен наследовать от `SimpleSplunkView` и переопределять следующие методы:

+ `createView` - создает объект при загрузке страницы и возвращает ссылку на него
+ `formatData` - форматирует массив данных для визуализации
+ `updateView` - помещает данные (из `formatData`) в созданный объект (из `createView`) и отрисовывает визуализацию.

Когда данные обновляются, основной код страницы последовательно вызывает методы `formatData` и `updateView`.

##Ссылки
* D3.js Example: [Collapsible Tree](https://bl.ocks.org/mbostock/4339083)
* About [Splunk Web Framework](http://dev.splunk.com/webframework)
